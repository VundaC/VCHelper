@page "/"
@inject ICommandService CommandService
@implements System.IDisposable

<h1>Hello, world!</h1>

Welcome to your new app.

<br />
<button type="button" @onclick="async () => await OnButtonPressed()">Press me</button>
<br />

@if (Response == true)
{
    <span style="color: green;">You pressed <b>Yes</b></span>
}
@if (Response == false)
{
    <span style="color: red;">You pressed <b>No</b></span>
}

<br />
<button type="button" @onclick="Count">@Clicks cliks</button>

@code
{
    @using VCHelper.Blazor.Services
    @using System.Threading

    private bool? Response;

    private int Clicks = 0;

    public static Index Instance { get; private set; }

    private CancellationTokenSource ClickingTCS = new CancellationTokenSource();

    protected override void OnInitialized()
    {
        Instance = this;
        base.OnInitialized();
    }

    private async Task OnButtonPressed()
    {
        Response = await CommandService.ExecuteCommand<Task<bool>>(
            "ShowAlert",
            "Confirm the action",
            "Press Yes or No to continue",
            "Yes",
            "No");

        StateHasChanged();
    }

    private async void Count()
    {
        while (!ClickingTCS.IsCancellationRequested)
        {
            Clicks++;
            StateHasChanged();
            await Task.Delay(100);
        }
    }

    public void Dispose()
    {
        ClickingTCS.Cancel();
    }
}
